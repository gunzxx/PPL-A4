<!DOCTYPE html>
<html>
<head>
  <title>ForeCasting harga kedelai </title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <canvas id="myChart"></canvas>

  <script>
    (async () => {
  
      let data_fetch;
      data_fetch = await fetch("https://ppl.gunzxx.my.id/api/kedelai");
      data_fetch = await data_fetch.json();
      console.log(await data_fetch);

      let data_kedelai = [];
      await data_fetch.forEach(element => {
        data_kedelai.push(parseInt(element['harga']));
      });
      console.log(await data_kedelai);
  
      // Mendefinisikan data
      const data_chart_kedelai = await {
        labels: ["Jan", "Feb", "Mar", "Apr", "Mei", "Jun", "Jul", "Agu", "Sep", "Okt", "Nov", "Des"],
        datasets: [
          {
            label: "Data Penjualan",
            data: [10123, 10042, 10231, 10273, 10283, 10331, 10385, 10372, 10395, 10383, 10236, 10214],
            backgroundColor: "rgba(54, 162, 235, 1)",
            borderColor: "rgba(54, 162, 235, 1)",
            borderWidth: 1
          },
        ]
      };
  
      // Menginisialisasi grafik
      const ctx = await document.getElementById("myChart").getContext("2d");
      const myChart = new Chart(ctx, {
        type: "line",
        data: await data_chart_kedelai,
        options: {
          responsive: true,
          scales: {
            yAxes: {
              ticks: {
                beginAtZero: true
              }
            }
          }
        }
      });
  
      // Membuat prediksi
      const lastData = data_chart_kedelai.datasets[0].data.slice(-3); // Mengambil 3 data terakhir
      const forecast = [lastData.reduce((a, b) => a + b, 0) / lastData.length]; // Menghitung rata-rata
      for (let i = 0; i < 11; i++) {
        forecast.push(forecast[forecast.length - 1]); // Menambahkan data prediksi sebanyak 11 bulan (total 12 bulan)
      }
  
      // Menambahkan data prediksi ke dataset
      myChart.data.datasets.push({
        label: "Prediksi",
        data: forecast,
        backgroundColor: "rgba(255, 99, 132, 0.2)",
        borderColor: "rgba(255, 99, 132, 1)",
        borderWidth: 1,
        borderDash: [5, 5]
      });
  
      // Memperbarui grafik
      myChart.update();
    })()
  </script>
</body>
</html>
